
<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Profile</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<script src="js/firebase_init.js"></script><script src="js/auth.js"></script></head><body class="theme-dark"><div class="app"><aside class="sidebar"><a class="icon" href="admin.html" title="Admin Panel">üõ†Ô∏è</a>
<!-- Admin & Friends Quick Links -->
<div style="margin-top:8px;display:flex;flex-direction:column;gap:6px">
  <a class="icon" href="friends.html" title="Friends">üë•</a>
  <a class="icon" href="requests.html" title="Requests">üì®</a>
  <a id="adminQuick" class="icon" href="admin.html" title="Admin" style="display:none">‚öôÔ∏è</a>
</div>
<script>
// show admin link if current user is admin (stored in localStorage ADMIN_EMAIL)
firebase && firebase.auth && firebase.auth().onAuthStateChanged(function(u){
  if(!u) return;
  var admin = (localStorage.getItem('ADMIN_EMAIL')||'proadmin@proton.me').trim().toLowerCase();
  if(u.email && u.email.trim().toLowerCase()===admin){
    var el = document.getElementById('adminQuick');
    if(el) el.style.display='inline-flex';
  }
});
</script>
<div class="logo"><img src="assets/server_logo.svg" style="width:48px;height:48px"></div><a class="icon" href="chat.html">üè†</a><a class="icon" href="dm.html">üí¨</a><a class="icon" href="friends.html">üë•</a><a class="icon" href="games.html">üéÆ</a><a class="icon" href="notifications.html">üîî</a></aside><div class="main"><div class="header"><div class="server-title">ChatPack</div></div><div class="content"><div class="channels" style="display:none"></div><div class="chat-area">
<header style="padding:12px;background:var(--card)"><a href="chat.html">Back</a> Profile</header>
<main style="padding:20px">
<div class="card" style="max-width:600px;margin:0 auto">
  <h3>Your Profile</h3>
  <input id="profileName" placeholder="Display name">
  <div><label>Upload PFP: <input type="file" id="pfpFile"></label><button id="uploadPfp">Upload</button></div>
  <div><img id="currentPfp" src="https://via.placeholder.com/128" width=128 height=128></div>
  <button id="saveProfile">Save</button>
</div>

<div style="margin-top:12px">
  <h3>Friends</h3>
  <input id="friendEmail" placeholder="friend email"><button id="sendFriendBtn">Send Friend Request</button>
</div>
<script>
document.getElementById('sendFriendBtn').addEventListener('click', function(){
  var email = document.getElementById('friendEmail').value.trim().toLowerCase();
  if(!email) return alert('Enter email');
  // write outgoing and incoming request
  var key = email.replace(/\./g,'_');
  var user = firebase.auth().currentUser; if(!user) return alert('Login');
  firebase.database().ref('friend_requests/'+key+'/'+user.uid).set({from:user.email,uid:user.uid,ts:Date.now()});
  firebase.database().ref('outgoing_requests/'+user.uid).push({to:email,ts:Date.now()});
  alert('Request sent');
});
</script>

<!-- GLOBAL CUSTOMIZATION LOADER -->
<script>
(function(){
  const custom = JSON.parse(localStorage.getItem('siteCustom')||'{}');
  if(custom.bgUrl){ document.body.style.backgroundImage = `url(${custom.bgUrl})`; }
  if(custom.accentColor){
    document.documentElement.style.setProperty('--accent', custom.accentColor);
  }
  if(custom.logoUrl){
    const logo=document.querySelector('.site-logo');
    if(logo) logo.src=custom.logoUrl;
  }
  if(custom.siteTitle){
    const t=document.querySelector('.site-title');
    if(t) t.textContent=custom.siteTitle;
    document.title = custom.siteTitle;
  }
})();
</script>

</body>
<script>
var auth=firebase.auth(); var db=firebase.database(); var storage=firebase.storage();
auth.onAuthStateChanged(function(user){ if(!user) return window.location.href='index.html'; db.ref('users/'+user.uid).once('value').then(function(s){ var data=s.val()||{}; document.getElementById('profileName').value=data.name||''; if(data.pfp) document.getElementById('currentPfp').src=data.pfp; }); });
document.getElementById('uploadPfp').addEventListener('click', function(){ var f=document.getElementById('pfpFile').files[0]; if(!f) return alert('Choose file'); var user=auth.currentUser; if(!user) return alert('Login'); var ref=storage.ref('pfps/'+user.uid+'/'+f.name); ref.put(f).then(function(){ ref.getDownloadURL().then(function(url){ db.ref('users/'+user.uid+'/pfp').set(url); document.getElementById('currentPfp').src=url; alert('Uploaded'); }); }); });
document.getElementById('saveProfile').addEventListener('click', function(){ saveProfile(); });
</script>

<h3>Nickname</h3>
<input id='nickname'><button onclick='saveNick()'>Save</button>
<script>
firebase.auth().onAuthStateChanged(u=>{
 if(!u)return;
 firebase.database().ref('users/'+u.uid+'/nickname').on('value',s=>{
   document.getElementById('nickname').value=s.val()||'';
 });
});
function saveNick(){
 let u=firebase.auth().currentUser;
 let n=document.getElementById('nickname').value;
 firebase.database().ref('users/'+u.uid+'/nickname').set(n);
 alert('Saved nickname');
}
</script>

<!-- GLOBAL CUSTOMIZATION LOADER -->
<script>
(function(){
  const custom = JSON.parse(localStorage.getItem('siteCustom')||'{}');
  if(custom.bgUrl){ document.body.style.backgroundImage = `url(${custom.bgUrl})`; }
  if(custom.accentColor){
    document.documentElement.style.setProperty('--accent', custom.accentColor);
  }
  if(custom.logoUrl){
    const logo=document.querySelector('.site-logo');
    if(logo) logo.src=custom.logoUrl;
  }
  if(custom.siteTitle){
    const t=document.querySelector('.site-title');
    if(t) t.textContent=custom.siteTitle;
    document.title = custom.siteTitle;
  }
})();
</script>

</body></html>
</div></div></div></div>
<!-- GLOBAL CUSTOMIZATION LOADER -->
<script>
(function(){
  const custom = JSON.parse(localStorage.getItem('siteCustom')||'{}');
  if(custom.bgUrl){ document.body.style.backgroundImage = `url(${custom.bgUrl})`; }
  if(custom.accentColor){
    document.documentElement.style.setProperty('--accent', custom.accentColor);
  }
  if(custom.logoUrl){
    const logo=document.querySelector('.site-logo');
    if(logo) logo.src=custom.logoUrl;
  }
  if(custom.siteTitle){
    const t=document.querySelector('.site-title');
    if(t) t.textContent=custom.siteTitle;
    document.title = custom.siteTitle;
  }
})();
</script>

</body></html>
<!-- Friend Actions -->
<div id="friendActions" style="margin-top:12px;display:flex;gap:8px">
  <button id="addFriendBtn">Add Friend</button>
  <button id="unfriendBtn">Unfriend</button>
  <button id="blockBtn">Block</button>
</div>
<script>
(function(){
  function sanitizeEmail(e){ return e.trim().toLowerCase().replace(/\./g,'_'); }
  document.getElementById('addFriendBtn').addEventListener('click', function(){ var email = prompt('Enter email to add friend'); if(!email) return; var key = sanitizeEmail(email); var user = firebase.auth().currentUser; if(!user) return alert('Login'); firebase.database().ref('friend_requests/'+key+'/'+user.uid).set({from:user.email,uid:user.uid,ts:Date.now()}); alert('Request sent'); });
  document.getElementById('unfriendBtn').addEventListener('click', function(){ var email = prompt('Enter friend email to remove'); if(!email) return; var user = firebase.auth().currentUser; if(!user) return alert('Login'); firebase.database().ref('users').orderByChild('email').equalTo(email).once('value').then(function(snap){ snap.forEach(function(ch){ var otherUid = ch.key; firebase.database().ref('friends/'+user.uid+'/'+otherUid).remove(); firebase.database().ref('friends/'+otherUid+'/'+user.uid).remove(); }); alert('Unfriended if existed'); }); });
  document.getElementById('blockBtn').addEventListener('click', function(){ var email = prompt('Enter email to block'); if(!email) return; var user = firebase.auth().currentUser; if(!user) return alert('Login'); firebase.database().ref('blocks/'+user.uid+'/'+sanitizeEmail(email)).set(true); alert('Blocked'); });
})();
</script>
